<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <!-- For Mobile Devices -->
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
        <meta name="generator" content="Doxygen 1.8.12"/>
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
        <title>Loom: Loom: LLVM instrumentation library</title>
        <!--<link href="tabs.css" rel="stylesheet" type="text/css"/>-->
        <script type="text/javascript" src="dynsections.js"></script>
        <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
        <link href="doxygen.css" rel="stylesheet" type="text/css" />
        <link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
        <link href='https://fonts.googleapis.com/css?family=Roboto+Slab' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
        <link rel="stylesheet" href="loom-dox.css"/>
        <script type="text/javascript" src="doxy-boot.js"></script>
    </head>
    <body>
        <nav class="navbar navbar-default" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand" href="index.html">Loom </a>
                </div>
                <ul class="nav navbar-nav">
                    <li><a href="namespaces.html">Namespaces</a></li>
                    <li><a href="annotated.html">Classes</a></li>
                    <li><a href="files.html">Files</a></li>
                </ul>
            </div>
        </nav>
        <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
            <div class="content" id="content">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-12 panel " style="padding-bottom: 15px;">
                            <div style="margin-bottom: 15px;">
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Loom: LLVM instrumentation library </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="image">
<img src="https://raw.githubusercontent.com/cadets/loom/master/doc/images/loom-small.png" align="right"/>
</div>
<p>Loom is a general-purpose library for adding instrumentation to software in the LLVM intermediate representation (IR) format. It is currently capable of generating static instrumentation points that expose values (e.g., function parameters and return values) to software-defined instrumentation functions.</p>
<p>Loom is part of the <a href="https://www.cl.cam.ac.uk/research/security/cadets">CADETS</a> (Causal, Adaptive, Distributed, and Efficient Tracing System) project as part of DARPA's <a href="http://www.darpa.mil/program/transparent-computing">Transparent Computing</a> program.</p>
<h2>Get it</h2>
<p>Loom itself is entirely contained within this GitHub repository, but it requires that you build <a href="http://llvm.org">LLVM</a> from source. In order to run Loom's test suite, you must also build a matching version of <a href="http://clang.llvm.org">Clang</a>.</p>
<div class="fragment"><div class="line">$ git clone https://github.com/cadets/llvm -b cadets llvm</div><div class="line">$ git clone https://github.com/cadets/clang -b cadets llvm/tools/clang</div><div class="line">$ git clone https://github.com/cadets/loom loom</div></div><!-- fragment --><h2>Build it</h2>
<h3>Building Clang/LLVM</h3>
<p>First, build LLVM using <a href="https://cmake.org">CMake</a> and <a href="https://ninja-build.org">Ninja</a>. The directions below assume a <code>Release</code> build, but a <code>Debug</code> build is also possible.</p>
<div class="fragment"><div class="line">$ mkdir llvm/Release</div><div class="line">$ cd llvm/Release</div><div class="line">$ cmake -G Ninja -D CMAKE_BUILD_TYPE=Release ..</div><div class="line">$ ninja</div><div class="line">[go get some coffee]</div></div><!-- fragment --><h3>Building LOOM</h3>
<ol type="1">
<li>Set your PATH to include the version of LLVM you just built: <div class="fragment"><div class="line">$ export PATH=/path/to/LLVM/Release/bin:$PATH</div></div><!-- fragment --> or: <div class="fragment"><div class="line">$ setenv PATH /path/to/LLVM/Release/bin:$PATH</div></div><!-- fragment --></li>
<li>Configure Loom build: <div class="fragment"><div class="line">$ cd /path/to/Loom</div><div class="line">$ mkdir Release</div><div class="line">$ cd Release</div><div class="line">$ cmake -G Ninja -D CMAKE_BUILD_TYPE=Release ..</div></div><!-- fragment --></li>
<li>Build Loom: <div class="fragment"><div class="line">$ ninja</div></div><!-- fragment --></li>
<li><p class="startli">(optional) run test suite:</p>
<p class="startli">a. Install <a href="https://github.com/Juniper/libxo">libxo</a>, which is used by Loom to emit structured output: </p><div class="fragment"><div class="line">$ pkg install libxo    # or whatever your package manager command is</div></div><!-- fragment --><p> b. Run the Loom test suite: </p><div class="fragment"><div class="line">$ ninja check</div></div><!-- fragment --></li>
</ol>
<h2>Use it</h2>
<h3><code>opt</code> pass</h3>
<p>Loom is structured as a set of libraries for LLVM instrumentation, but can be run most straightforwardly as an LLVM <a href="http://llvm.org/docs/CommandGuide/opt.html">opt</a> pass. This requires creating an instrumentation policy file such as: </p><div class="fragment"><div class="line">#</div><div class="line"># There are two instrumentation strategies:</div><div class="line">#  * callout:  call an instrumentation function like __loom_called_foo</div><div class="line">#  * inline    inject instrumentation inline with instrumented events</div><div class="line">#</div><div class="line">strategy: callout</div><div class="line"></div><div class="line">#</div><div class="line"># When using callout instrumentation, the generated instrumentation functions</div><div class="line"># are named __loom_{event-specific-name} by default. This configuration value</div><div class="line"># allows the `__loom` prefix to be overridden.</div><div class="line">#</div><div class="line">hook_prefix: __test_hook</div><div class="line"></div><div class="line">#</div><div class="line"># Loom can automatically log events and their immediate values (e.g., when</div><div class="line"># logging a call to foo(1, 2, 3.1415), emit &quot;foo&quot;, 1, 2 and 3.1415) without</div><div class="line"># any processing. Strategies include:</div><div class="line">#</div><div class="line">#  * none      do not use the simple logger</div><div class="line">#  * printf    just print the event using printf()</div><div class="line">#  * xo        use libxo to emit a structured representation (e.g., json)</div><div class="line">#</div><div class="line">logging: printf</div><div class="line"></div><div class="line">#</div><div class="line"># Specify how/when functions should be instrumented.</div><div class="line">#</div><div class="line"># Functions can be instrumented on the caller side (before/after the call)</div><div class="line"># or the callee side (function prelude / return sites). This configuration</div><div class="line"># value should be a list of entries, each specifying:</div><div class="line">#</div><div class="line">#  * `name`: the name of the function being instrumented (language-mangled)</div><div class="line">#  * `caller`: (optional) list of directions to instrument calls (entry/exit)</div><div class="line">#  * `callee`: (optional) list of directions to instrument functions</div><div class="line">#</div><div class="line">functions:</div><div class="line">    - name: foo</div><div class="line">      caller: [ entry, exit ]</div><div class="line"></div><div class="line">    - name: bar</div><div class="line">      caller: [ entry ]</div><div class="line">      callee: [ exit ]</div><div class="line"></div><div class="line">#</div><div class="line"># Specify how/when structure fields should be instrumented.</div><div class="line">#</div><div class="line"># We can instrument both reads and writes to structure fields.</div><div class="line"># These fields must currently be identified by number rather than name.</div><div class="line"># The `structures` config value is a list of entries containing:</div><div class="line">#</div><div class="line">#  * `name`: the structure name</div><div class="line">#  * `fields`: a list of structure field descriptions:</div><div class="line">#    * `name`: field name</div><div class="line">#    * `operations`: list of operations to instrument (`read` or `write`)</div><div class="line">#</div><div class="line">structures:</div><div class="line">  - name: baz</div><div class="line">    fields:</div><div class="line">      - name: refcount</div><div class="line">        operations: [ read, write ]</div></div><!-- fragment --><p>and then running <code>opt</code>:</p>
<div class="fragment"><div class="line">$ opt -load /path/to/LLVMLoom.so -loom -loom-file /path/to/instr.policy</div></div><!-- fragment --><p>Loom's <code>opt</code> pass has options that can be seen in the help/usage output:</p>
<div class="fragment"><div class="line">$ opt -load /path/to/LLVMLoom.so -help | grep loom</div></div><!-- fragment --><h3>Instrumenting FreeBSD</h3>
<p>To build FreeBSD with Loom, you need to clone our <a href="https://github.com/cadets/freebsd/branches/loom">IR-augmented version of FreeBSD</a>. Then, you can use our <code>loom-fbsdmake</code> script as a drop-in wrapper around <code>make</code>:</p>
<div class="fragment"><div class="line">$ git clone https://github.com/cadets/freebsd -b loom freebsd-loom</div><div class="line">$ cd freebsd-loom</div><div class="line">$ export LLVM_PREFIX=/path/to/LLVM/Release</div><div class="line">$ export LOOM_LIB=/path/to/Loom/Release/lib/LLVMLoom.so</div><div class="line">$ /path/to/Loom/scripts/loom-fbsdmake buildworld buildkernel</div><div class="line">$ /path/to/Loom/scripts/loom-fbsdmake buildenv   # etc.</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
</div>
</div>
</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.12
</small></address>
</body>
</html>
